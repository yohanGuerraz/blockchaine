{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reducer = exports.combineReducers = void 0;\n\nconst logger_1 = __importDefault(require(\"../logger\"));\n\nconst types_1 = require(\"../types\");\n\nconst utils_1 = require(\"./utils\");\n\nconst status_1 = require(\"../utils/status\");\n\nconst combineReducers = function () {\n  for (var _len = arguments.length, reducers = new Array(_len), _key = 0; _key < _len; _key++) {\n    reducers[_key] = arguments[_key];\n  }\n\n  return (state, action) => reducers.reduce((newState, reducer) => reducer(newState, action), state);\n};\n\nexports.combineReducers = combineReducers;\n\nconst reducer = (state, action) => {\n  var _a;\n\n  const gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n  const updatedState = Object.assign(Object.assign({}, state), {\n    gatewayStatus\n  }); // eslint-disable-next-line no-prototype-builtins\n\n  const tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n  logger_1.default.debug(`reducer.action: ${action.type}`, (0, status_1.statusDisplayValue)(updatedState.gatewayStatus));\n\n  switch (action.type) {\n    case 'startWalletPowo':\n      {\n        return Object.assign(Object.assign({}, updatedState), {\n          walletPowoInProgress: true\n        });\n      }\n\n    case 'walletPowoComplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, updatedState), {\n          // only move to IN_REVIEW if it's during the initial token creation flow\n          gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus,\n          walletPowoInProgress: false,\n          firstTokenCheck: false\n        });\n      }\n\n    case 'walletPowoIncomplete':\n      {\n        logger_1.default.debug('tokenCreationInProgress', {\n          tokenCreationInProgress\n        });\n        return Object.assign(Object.assign({}, state), {\n          renderIframe: false,\n          iframeMinimized: true,\n          powoFinished: false,\n          refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS\n        });\n      }\n\n    case 'tokenChange':\n      return Object.assign(Object.assign({}, state), {\n        gatewayStatus: (0, utils_1.statusFromToken)(state, action.token),\n        powoFinished: false,\n        gatewayToken: action.token,\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED\n      });\n\n    case 'powoComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP,\n        powoFinished: true,\n        powoRequested: undefined,\n        refreshTimeoutId: undefined,\n        refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS ? types_1.RefreshTokenState.REQUIRES_POWO : state.refreshTokenState\n      });\n\n    case 'walletDisconnected':\n      return (0, utils_1.resetState)(state);\n\n    case 'requestGatekeeperIssuance':\n      return Object.assign(Object.assign({}, updatedState), {\n        powoFinished: false,\n        walletPowoInProgress: false,\n        tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS\n      });\n\n    case 'requestGatekeeperIssuanceComplete':\n      return Object.assign(Object.assign({}, updatedState), {\n        tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED,\n        gatewayTokenTransaction: action.gatewayTokenTransaction,\n        civicPass: Object.assign(Object.assign({}, updatedState.civicPass), {\n          responsePayload: undefined\n        })\n      });\n\n    case 'requestGatekeeperIssuanceFailed':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatewayStatus: types_1.GatewayStatus.ERROR,\n        tokenIssuanceState: types_1.TokenIssuanceState.FAILED\n      });\n\n    case 'refreshAttemptDone':\n      return Object.assign(Object.assign({}, updatedState), {\n        refreshInProgress: false\n      });\n\n    case 'updateStateWithProps':\n      return Object.assign(Object.assign({}, state), {\n        stage: action.stage,\n        walletAddress: action.walletAddress,\n        redirectUrl: action.redirectUrl,\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        ownerSigns: action.ownerSigns\n      });\n\n    case 'tokenNotFoundError':\n      return Object.assign(Object.assign({}, state), {\n        renderIframe: false,\n        iframeMinimized: true,\n        gatewayStatus: types_1.GatewayStatus.ERROR\n      });\n\n    case 'gatekeeperNetworkChanged':\n      return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), {\n        gatekeeperNetworkAddress: action.gatekeeperNetworkAddress,\n        walletAddress: state.walletAddress\n      });\n\n    default:\n      return state;\n  }\n};\n\nexports.reducer = reducer;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","reducer","combineReducers","logger_1","require","types_1","utils_1","status_1","reducers","state","action","reduce","newState","_a","gatewayStatus","statusFromToken","gatewayToken","GatewayStatus","UNKNOWN","updatedState","assign","tokenCreationInProgress","civicPass","responsePayload","hasOwnProperty","CivicPassMessageAction","ISSUANCE","default","debug","type","statusDisplayValue","walletPowoInProgress","IN_REVIEW","firstTokenCheck","renderIframe","iframeMinimized","powoFinished","refreshTokenState","RefreshTokenState","IN_PROGRESS","token","tokenIssuanceState","TokenIssuanceState","COMPLETED","PROOF_OF_WALLET_OWNERSHIP","powoRequested","undefined","refreshTimeoutId","REQUIRES_POWO","resetState","gatewayTokenTransaction","ERROR","FAILED","refreshInProgress","stage","walletAddress","redirectUrl","gatekeeperNetworkAddress","ownerSigns"],"sources":["C:/Users/Guerraz Yohan/Desktop/metaplex/js/packages/candy-machine-ui/node_modules/@civic/common-gateway-react/dist/esm/useReducer/reducer.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reducer = exports.combineReducers = void 0;\nconst logger_1 = __importDefault(require(\"../logger\"));\nconst types_1 = require(\"../types\");\nconst utils_1 = require(\"./utils\");\nconst status_1 = require(\"../utils/status\");\nconst combineReducers = (...reducers) => (state, action) => reducers.reduce((newState, reducer) => reducer(newState, action), state);\nexports.combineReducers = combineReducers;\nconst reducer = (state, action) => {\n    var _a;\n    const gatewayStatus = (0, utils_1.statusFromToken)(state, state.gatewayToken) || types_1.GatewayStatus.UNKNOWN;\n    const updatedState = Object.assign(Object.assign({}, state), { gatewayStatus });\n    // eslint-disable-next-line no-prototype-builtins\n    const tokenCreationInProgress = !!((_a = updatedState.civicPass.responsePayload) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(types_1.CivicPassMessageAction.ISSUANCE));\n    logger_1.default.debug(`reducer.action: ${action.type}`, (0, status_1.statusDisplayValue)(updatedState.gatewayStatus));\n    switch (action.type) {\n        case 'startWalletPowo': {\n            return Object.assign(Object.assign({}, updatedState), { walletPowoInProgress: true });\n        }\n        case 'walletPowoComplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, updatedState), { \n                // only move to IN_REVIEW if it's during the initial token creation flow\n                gatewayStatus: tokenCreationInProgress ? types_1.GatewayStatus.IN_REVIEW : updatedState.gatewayStatus, walletPowoInProgress: false, firstTokenCheck: false });\n        }\n        case 'walletPowoIncomplete': {\n            logger_1.default.debug('tokenCreationInProgress', { tokenCreationInProgress });\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, powoFinished: false, refreshTokenState: types_1.RefreshTokenState.IN_PROGRESS });\n        }\n        case 'tokenChange':\n            return Object.assign(Object.assign({}, state), { gatewayStatus: (0, utils_1.statusFromToken)(state, action.token), powoFinished: false, gatewayToken: action.token, tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED });\n        case 'powoComplete':\n            return Object.assign(Object.assign({}, updatedState), { gatewayStatus: types_1.GatewayStatus.PROOF_OF_WALLET_OWNERSHIP, powoFinished: true, powoRequested: undefined, refreshTimeoutId: undefined, refreshTokenState: state.refreshTokenState === types_1.RefreshTokenState.IN_PROGRESS\n                    ? types_1.RefreshTokenState.REQUIRES_POWO\n                    : state.refreshTokenState });\n        case 'walletDisconnected':\n            return (0, utils_1.resetState)(state);\n        case 'requestGatekeeperIssuance':\n            return Object.assign(Object.assign({}, updatedState), { powoFinished: false, walletPowoInProgress: false, tokenIssuanceState: types_1.TokenIssuanceState.IN_PROGRESS });\n        case 'requestGatekeeperIssuanceComplete':\n            return Object.assign(Object.assign({}, updatedState), { tokenIssuanceState: types_1.TokenIssuanceState.COMPLETED, gatewayTokenTransaction: action.gatewayTokenTransaction, civicPass: Object.assign(Object.assign({}, updatedState.civicPass), { responsePayload: undefined }) });\n        case 'requestGatekeeperIssuanceFailed':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatewayStatus: types_1.GatewayStatus.ERROR, tokenIssuanceState: types_1.TokenIssuanceState.FAILED });\n        case 'refreshAttemptDone':\n            return Object.assign(Object.assign({}, updatedState), { refreshInProgress: false });\n        case 'updateStateWithProps':\n            return Object.assign(Object.assign({}, state), { stage: action.stage, walletAddress: action.walletAddress, redirectUrl: action.redirectUrl, gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, ownerSigns: action.ownerSigns });\n        case 'tokenNotFoundError':\n            return Object.assign(Object.assign({}, state), { renderIframe: false, iframeMinimized: true, gatewayStatus: types_1.GatewayStatus.ERROR });\n        case 'gatekeeperNetworkChanged':\n            return Object.assign(Object.assign({}, (0, utils_1.resetState)(state)), { gatekeeperNetworkAddress: action.gatekeeperNetworkAddress, walletAddress: state.walletAddress });\n        default:\n            return state;\n    }\n};\nexports.reducer = reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}