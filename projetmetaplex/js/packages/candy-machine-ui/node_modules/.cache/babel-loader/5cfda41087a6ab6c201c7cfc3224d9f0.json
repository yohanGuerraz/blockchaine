{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport BloctoSDK from '@blocto/sdk';\nimport { BaseWalletAdapter, WalletAccountError, WalletAdapterNetwork, WalletConnectionError, WalletDisconnectionError, WalletNotConnectedError, WalletNotFoundError, WalletPublicKeyError, WalletSendTransactionError } from '@solana/wallet-adapter-base';\nimport { PublicKey } from '@solana/web3.js';\nexport class BloctoWalletAdapter extends BaseWalletAdapter {\n  constructor() {\n    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this._connecting = false;\n    this._wallet = null;\n    this._publicKey = null;\n    this._network = config.network || WalletAdapterNetwork.Mainnet;\n  }\n\n  get publicKey() {\n    return this._publicKey;\n  }\n\n  get ready() {\n    return true;\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  get connected() {\n    return !!this._publicKey;\n  }\n\n  connect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        if (this.connected || this.connecting) return;\n        this._connecting = true;\n        const wallet = new BloctoSDK({\n          solana: {\n            net: this._network\n          }\n        }).solana;\n        if (!wallet) throw new WalletNotFoundError();\n\n        if (!wallet.connected) {\n          try {\n            yield wallet.connect();\n          } catch (error) {\n            throw new WalletConnectionError(error === null || error === void 0 ? void 0 : error.message, error);\n          }\n        }\n\n        const account = wallet.accounts[0];\n        if (!account) throw new WalletAccountError();\n        let publicKey;\n\n        try {\n          publicKey = new PublicKey(account);\n        } catch (error) {\n          throw new WalletPublicKeyError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        this._wallet = wallet;\n        this._publicKey = publicKey;\n        this.emit('connect');\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      } finally {\n        this._connecting = false;\n      }\n    });\n  }\n\n  disconnect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const wallet = this._wallet;\n\n      if (wallet) {\n        this._wallet = null;\n        this._publicKey = null;\n\n        try {\n          yield wallet.disconnect();\n        } catch (error) {\n          this.emit('error', new WalletDisconnectionError(error === null || error === void 0 ? void 0 : error.message, error));\n        }\n      }\n\n      this.emit('disconnect');\n    });\n  }\n\n  sendTransaction(transaction, connection) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new WalletNotConnectedError();\n\n        try {\n          transaction.feePayer || (transaction.feePayer = this.publicKey || undefined);\n          transaction.recentBlockhash || (transaction.recentBlockhash = (yield connection.getRecentBlockhash('finalized')).blockhash);\n          const {\n            signers\n          } = options;\n\n          if (signers === null || signers === void 0 ? void 0 : signers.length) {\n            transaction = yield wallet.convertToProgramWalletTransaction(transaction);\n            transaction.partialSign(...signers);\n          }\n\n          return yield wallet.signAndSendTransaction(transaction, connection);\n        } catch (error) {\n          throw new WalletSendTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n}","map":{"version":3,"mappings":"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","names":["BloctoSDK","BaseWalletAdapter","WalletAccountError","WalletAdapterNetwork","WalletConnectionError","WalletDisconnectionError","WalletNotConnectedError","WalletNotFoundError","WalletPublicKeyError","WalletSendTransactionError","PublicKey","BloctoWalletAdapter","constructor","config","_connecting","_wallet","_publicKey","_network","network","Mainnet","publicKey","ready","connecting","connected","connect","wallet","solana","net","error","message","account","accounts","emit","disconnect","sendTransaction","transaction","connection","options","feePayer","undefined","recentBlockhash","getRecentBlockhash","blockhash","signers","length","convertToProgramWalletTransaction","partialSign","signAndSendTransaction"],"sourceRoot":"","sources":["../src/adapter.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}