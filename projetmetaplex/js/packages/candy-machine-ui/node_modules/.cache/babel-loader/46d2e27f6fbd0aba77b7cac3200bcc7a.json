{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction sanitize(params, defaults) {\n  const result = Object.assign(Object.assign({}, defaults), params);\n\n  if (typeof result.retries === 'undefined') {\n    result.retries = defaults.retries;\n  }\n\n  if (typeof result.retryDelay === 'undefined') {\n    result.retryDelay = defaults.retryDelay;\n  }\n\n  if (typeof result.retryOn === 'undefined') {\n    result.retryOn = defaults.retryOn;\n  }\n\n  return result;\n} // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\nfunction default_1(fetchFunc) {\n  let params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const defaults = sanitize(params, {\n    retries: 3,\n    retryDelay: 500,\n    retryOn: [419, 503, 504]\n  });\n  return function (input, init) {\n    const frp = sanitize({\n      retries: init === null || init === void 0 ? void 0 : init.retries,\n      retryDelay: init === null || init === void 0 ? void 0 : init.retryDelay,\n      retryOn: init === null || init === void 0 ? void 0 : init.retryOn\n    }, defaults);\n    const retryDelayFn = typeof frp.retryDelay === 'function' ? frp.retryDelay : () => frp.retryDelay;\n    const retryOnFn = typeof frp.retryOn === 'function' ? frp.retryOn : (attempt, retries, error, response) => (!!error || !response || frp.retryOn.indexOf(response.status) !== -1) && attempt < retries;\n    return new Promise(function (resolve, reject) {\n      const extendedFetch = function (attempt) {\n        fetchFunc(input, init).then(function (response) {\n          if (retryOnFn(attempt, frp.retries, null, response)) {\n            // eslint-disable-next-line @typescript-eslint/no-use-before-define\n            retry(attempt, null, response);\n          } else {\n            resolve(response);\n          }\n        }).catch(function (error) {\n          if (retryOnFn(attempt, frp.retries, error, null)) {\n            // eslint-disable-next-line @typescript-eslint/no-use-before-define\n            retry(attempt, error, null);\n          } else {\n            reject(error);\n          }\n        });\n      };\n\n      function retry(attempt, error, response) {\n        setTimeout(function () {\n          extendedFetch(++attempt);\n        }, retryDelayFn(attempt, error, response));\n      }\n\n      extendedFetch(0);\n    });\n  };\n}\n\nexports.default = default_1;","map":{"version":3,"mappings":"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","names":["sanitize","params","defaults","result","retries","retryDelay","retryOn","fetchFunc","input","init","frp","retryDelayFn","retryOnFn","attempt","error","response","indexOf","status","Promise","resolve","reject","extendedFetch","then","retry","catch","setTimeout","exports"],"sourceRoot":"","sources":["../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}